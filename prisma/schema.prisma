generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                Int                 @id @default(autoincrement())
  name              String?
  email             String?             @unique
  password          String?
  password_text     String?
  created_at        DateTime            @default(now()) @map(name: "created_at")
  updated_at        DateTime            @updatedAt @map(name: "updated_at")
  parcels           Parcel[]
  Wallet            Wallet?
  WithdrawalRequest WithdrawalRequest[]
  PaymentHistory    PaymentHistory[]

  @@map("users")
}

model Parcel {
  id               Int     @id @default(autoincrement())
  tracking         String?
  user_id          Int? // Foreign key to the User model
  order_id         String? @unique
  from_wilaya_id   Int?
  from_wilaya_name String
  firstname        String
  familyname       String
  contact_phone    String

  // location
  address         String?
  to_commune_id   Int?
  to_commune_name String
  to_wilaya_id    Int?
  to_wilaya_name  String
  to_center_id    Int?
  to_center_name  String?
  stopdesk_name   String?
  is_stopdesk     Boolean

  product_list       String
  price              Int
  do_insurance       Boolean
  declared_value     Int?
  height             Int?
  width              Int?
  length             Int?
  weight             Float?
  freeshipping       Boolean
  stopdesk_id        Int?
  has_exchange       Boolean
  product_to_collect String?

  import_id Int?
  label     String?
  labels    String?
  message   String?
  success   Boolean?

  grouped_tracking String?

  taxe_percentage  Decimal?
  taxe_from        Int?
  taxe_retour      Int?
  delivery_fee     Int?
  date_creation    DateTime?
  date_expedition  DateTime?
  date_last_status DateTime?
  last_status      String?
  parcel_type      String?
  parcel_sub_type  String?

  qr_text String?
  pin     String?

  status         String?
  payment_id     String?
  payment_status String?
  event_id       String?
  occurred_at    DateTime?

  is_printed Boolean @default(false)

  user User? @relation(fields: [user_id], references: [id])

  created_at     DateTime         @default(now())
  updated_at     DateTime         @updatedAt
  PaymentHistory PaymentHistory[]

  @@map("parcels") // Optional:  Map the model to a specific table name
}

/**
 * |--------------------------------------------------------------------------
 * | Wallet
 * |--------------------------------------------------------------------------
 */
model Wallet {
  id             Int      @id @default(autoincrement())
  user_id        Int      @unique
  crypto_type    String
  wallet_address String
  balance        Decimal  @default(0)
  created_at     DateTime @default(now())
  updated_at     DateTime @updatedAt
  user           User?    @relation(fields: [user_id], references: [id])

  @@map("wallets")
}

model WithdrawalRequest {
  id             Int              @id @default(autoincrement())
  user_id        Int?
  amount         Decimal
  crypto_type    String
  wallet_address String
  status         WithdrawalStatus @default(PENDING)
  requested_at   DateTime         @default(now())
  processed_at   DateTime?
  transaction_id String?
  notes          String?
  user           User?            @relation(fields: [user_id], references: [id])

  @@map("withdrawal_requests")
}

model PaymentHistory {
  id             Int      @id @default(autoincrement())
  user_id        Int?
  amount         Decimal
  payment_date   DateTime @default(now())
  description    String?
  transaction_id String?
  parcel_id      Int? // Links to Parcel for credit/debit tracking
  type           String // "CREDIT" or "DEBIT"
  user           User?    @relation(fields: [user_id], references: [id])
  parcel         Parcel?  @relation(fields: [parcel_id], references: [id])

  @@map("payment_history")
}

enum WithdrawalStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
}
